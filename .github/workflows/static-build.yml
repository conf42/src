name: Build and Deploy
on: [push]
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v4

      - name: Install
        run: |
          make deps

      - name: Free disk space
        run: |
          echo '===== Before ====='
          df -h
          
          echo '===== Cleanup ====='
          sudo swapoff -a
          sudo rm -f /swapfile
          sudo apt clean
          sudo docker image prune --all --force
          
          sudo rm -rf /opt/hostedtoolcache/go
          sudo rm -rf /opt/hostedtoolcache/CodeQL
          sudo rm -rf /usr/lib/google-cloud-sdk
          sudo rm -rf /usr/local/julia*
          sudo rm -rf /usr/local/.ghcup
          sudo rm -rf /usr/share/swift
          sudo rm -rf /usr/share/dotnet
          sudo apt-get clean
          
          echo '===== After ====='
          df -h

      - name: Build ğŸ”§
        run: |
          make generate

      - name: Deploy ğŸš€
        uses: JamesIves/github-pages-deploy-action@4.1.0
        with:
          branch: gh-pages
          folder: docs

      - name: Free disk space left
        run: |
          df -h
